<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Browse through our collection of code snippets, scripts, and tools. Find what you need or discover something new.">
    <meta name="theme-color" content="#dc2626"> 
    <title>Eberardos API</title>
    <link rel="icon" href="/assets/icon.png" type="image/jpeg">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Ubuntu+Mono:ital,wght@0,400;0,700;1,400;1,700&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script>
  tailwind.config = {
    darkMode: 'class',
    theme: {
      extend: {
        fontFamily: {
          'mono': ['Ubuntu Mono', 'monospace'],
          'sans': ['Inter', 'sans-serif'],
        },
        colors: {
            'primary': '#dc2626', // Warna merah yang kamu gunakan
            'primary-dark': '#b91c1c', 
        }
      }
    }
  }
</script>
<style>
    /* Custom Scrollbar */
    ::-webkit-scrollbar {
        width: 10px;
    }
    ::-webkit-scrollbar-track {
        background: #1f2937; /* bg-gray-800 */
    }
    ::-webkit-scrollbar-thumb {
        background: #374151; /* bg-gray-600 */
        border-radius: 5px;
    }
    ::-webkit-scrollbar-thumb:hover {
        background: #4b5563; /* bg-gray-500 */
    }
    
    /* Notification Modal Styles */
    .notification-modal {
        display: none;
        position: fixed;
        z-index: 100; 
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        overflow: auto;
        background-color: rgba(0,0,0,0.5); 
        padding-top: 60px;
    }
    .modal-content {
        background-color: #1f2937;
        margin: 5% auto;
        padding: 20px;
        border: 1px solid #374151;
        width: 80%; 
        max-width: 600px;
        border-radius: 8px;
    }
    .close-btn {
        color: #aaa;
        float: right;
        font-size: 28px;
        font-weight: bold;
    }
    .close-btn:hover,
    .close-btn:focus {
        color: white;
        text-decoration: none;
        cursor: pointer;
    }
    .notification-list {
        max-height: 400px;
        overflow-y: auto;
    }
    .notification-item {
        border-bottom: 1px solid #374151;
        padding: 10px 0;
        cursor: pointer;
    }
    .notification-item:last-child {
        border-bottom: none;
    }
    .notification-item.unread .title {
        font-weight: bold;
    }
</style>
</head>
<body class="bg-gray-900 text-gray-100 font-sans min-h-screen">

    <header class="bg-gray-800 shadow-md sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="flex-shrink-0">
                    <a href="/" class="text-xl font-bold tracking-tight text-primary">Eberardos API</a>
                </div>

                <div class="flex items-center space-x-4">
                    <span id="apiStatus" class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-red-800 text-red-100">
                        <i class="fas fa-circle mr-1 text-red-500"></i> Loading...
                    </span>
                    
                    <div class="relative">
                        <button id="notificationBtn" class="p-2 rounded-full hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-primary">
                            <i class="material-icons text-white">notifications</i>
                            <span id="unreadCount" class="absolute top-0 right-0 inline-flex items-center justify-center px-2 py-1 text-xs font-bold leading-none text-red-100 transform translate-x-1/2 -translate-y-1/2 bg-red-600 rounded-full hidden">0</span>
                        </button>
                    </div>

                    <button id="apikeyBtn" class="bg-primary hover:bg-primary-dark text-white font-semibold py-1.5 px-4 rounded-lg transition duration-150 ease-in-out">
                        API Key
                    </button>
                </div>
            </div>
        </div>
    </header>

    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        
        <div id="bannerContainer" class="mb-8 rounded-lg overflow-hidden shadow-xl" style="height: 200px; background-color: #2d3748;">
            <img id="bannerImage" src="" alt="API Banner" class="w-full h-full object-cover opacity-50" style="display: none;">
            <div id="bannerPlaceholder" class="w-full h-full flex items-center justify-center text-gray-500 text-xl" style="display: none;">
                Loading Banner...
            </div>
        </div>

        <div class="mb-8 relative">
            <input type="text" id="searchInput" placeholder="Cari endpoint API (misal: /download/tiktok atau nama fitur)"
                   class="w-full p-3 pl-10 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:ring-primary focus:border-primary">
            <i class="material-icons absolute left-3 top-3.5 text-gray-400">search</i>
        </div>

        <div id="apiList" class="space-y-8">
            </div>

        <div id="noResults" class="hidden text-center py-12 text-gray-400">
            <i class="material-icons text-6xl mb-4">sentiment_dissatisfied</i>
            <h3 class="text-xl font-semibold">Tidak Ada Hasil Ditemukan</h3>
            <p>Coba kata kunci lain atau periksa ejaanmu.</p>
        </div>
    </main>

    <footer class="bg-gray-800 mt-12 py-6">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center text-gray-400">
            <p>&copy; <span id="currentYear"></span> <a href="/" class="text-primary hover:text-primary-dark font-semibold">Eberardos API</a>. All rights reserved.</p>
            <p class="text-sm mt-1">Creator: <span id="apiCreator" class="text-gray-300">Loading...</span></p>
        </div>
    </footer>

    <div id="notificationModal" class="notification-modal">
        <div class="modal-content">
            <span class="close-btn" onclick="closeNotificationModal()">&times;</span>
            <h2 class="text-xl font-bold mb-4 text-white">Notifikasi Terbaru</h2>
            <div id="notificationList" class="notification-list text-gray-300">
                </div>
            <button onclick="markAllAsRead()" class="mt-4 bg-primary hover:bg-primary-dark text-white text-sm py-1.5 px-3 rounded-md">
                Tandai Semua Sudah Dibaca
            </button>
        </div>
    </div>

    <div id="apikeyModal" class="notification-modal">
        <div class="modal-content">
            <span class="close-btn" onclick="closeApikeyModal()">&times;</span>
            <h2 class="text-xl font-bold mb-4 text-white">API Key</h2>
            <p class="text-gray-300 mb-4">Gunakan salah satu API key berikut untuk mengakses endpoint yang memerlukan autentikasi:</p>
            <div id="apikeyList" class="bg-gray-700 p-3 rounded-lg overflow-x-auto font-mono text-sm text-green-300">
                Loading API Keys...
            </div>
            <p class="text-xs text-gray-400 mt-2">API key bersifat rahasia, jangan bagikan kepada siapapun!</p>
        </div>
    </div>
    
    <script>
    const apiBaseUrl = window.location.origin;

    // Helper to format endpoint path with base URL
    function formatPath(path) {
        return apiBaseUrl + path;
    }

    // Modal Handlers
    function openNotificationModal() {
        document.getElementById('notificationModal').style.display = 'block';
    }

    function closeNotificationModal() {
        document.getElementById('notificationModal').style.display = 'none';
        document.getElementById('unreadCount').classList.add('hidden');
    }

    function openApikeyModal() {
        document.getElementById('apikeyModal').style.display = 'block';
    }

    function closeApikeyModal() {
        document.getElementById('apikeyModal').style.display = 'none';
    }

    // Close modals when clicking outside
    window.onclick = function(event) {
        const notifModal = document.getElementById('notificationModal');
        const apikeyModal = document.getElementById('apikeyModal');
        if (event.target == notifModal) {
            closeNotificationModal();
        }
        if (event.target == apikeyModal) {
            closeApikeyModal();
        }
    }

    document.getElementById('notificationBtn').addEventListener('click', openNotificationModal);
    document.getElementById('apikeyBtn').addEventListener('click', openApikeyModal);

    // Initial load for API status, routes, and apikeys
    async function loadApiStatusAndSettings() {
        try {
            const statusRes = await fetch(apiBaseUrl + '/api/status');
            const statusData = await statusRes.json();

            const settingsRes = await fetch(apiBaseUrl + '/settings.json');
            const settings = await settingsRes.json();

            // Update Status
            const statusElement = document.getElementById('apiStatus');
            statusElement.innerHTML = `<i class="fas fa-circle mr-1 ${statusData.result.status === 'Aktif' ? 'text-green-500' : 'text-red-500'}"></i> ${statusData.result.status}`;
            statusElement.className = `inline-flex items-center px-3 py-1 rounded-full text-xs font-medium ${statusData.result.status === 'Aktif' ? 'bg-green-800 text-green-100' : 'bg-red-800 text-red-100'}`;

            // Update Footer
            document.getElementById('apiCreator').textContent = settings.apiSettings.creator || 'N/A';
            document.getElementById('currentYear').textContent = new Date().getFullYear();

            // Update API Keys
            const apikeyListElement = document.getElementById('apikeyList');
            if (settings.apiSettings.apikey && settings.apiSettings.apikey.length > 0) {
                apikeyListElement.innerHTML = settings.apiSettings.apikey.map(key => `<span class="block">${key}</span>`).join('');
            } else {
                apikeyListElement.textContent = 'Tidak ada API Key yang terdaftar.';
            }

            // Update Banner
            const bannerContainer = document.getElementById('bannerContainer');
            const bannerImage = document.getElementById('bannerImage');
            const bannerPlaceholder = document.getElementById('bannerPlaceholder');
            if (settings.bannerImage) {
                bannerImage.src = settings.bannerImage;
                bannerImage.style.display = 'block';
                bannerPlaceholder.style.display = 'none';
                bannerContainer.style.backgroundColor = 'transparent'; 
                bannerContainer.style.height = 'auto'; // Auto height if there's an image
            } else {
                bannerPlaceholder.textContent = `${settings.name || 'API'} v${settings.version || '1.0'}`;
                bannerPlaceholder.style.display = 'flex';
                bannerContainer.style.height = '150px'; 
            }


        } catch (e) {
            console.error('Error loading API status or settings:', e);
            document.getElementById('apiStatus').innerHTML = '<i class="fas fa-circle mr-1 text-red-500"></i> Error';
            document.getElementById('apiStatus').className = 'inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-red-800 text-red-100';
            document.getElementById('bannerPlaceholder').textContent = 'Gagal memuat data API.';
            document.getElementById('bannerPlaceholder').style.display = 'flex';
            document.getElementById('apikeyList').textContent = 'Gagal memuat API Keys.';
        }
    }

    // Load API Endpoints
    async function loadApis() {
        await loadApiStatusAndSettings();

        try {
            const response = await fetch(apiBaseUrl + '/settings.json');
            const settings = await response.json();
            const apiListElement = document.getElementById('apiList');
            apiListElement.innerHTML = ''; // Clear previous content

            settings.categories.forEach(category => {
                const categoryGroup = document.createElement('div');
                categoryGroup.className = 'category-group bg-gray-800 p-6 rounded-xl shadow-lg';
                
                const header = document.createElement('h2');
                header.className = 'text-2xl font-bold mb-4 text-white border-b border-primary pb-2';
                header.textContent = category.name;
                categoryGroup.appendChild(header);

                const itemsContainer = document.createElement('div');
                itemsContainer.className = 'space-y-4';

                category.items.forEach(item => {
                    const apiItem = document.createElement('div');
                    apiItem.className = 'api-item p-4 bg-gray-700 rounded-lg border-l-4 transition duration-200 ease-in-out hover:bg-gray-600';
                    apiItem.setAttribute('data-path', item.path || '');
                    apiItem.setAttribute('data-alias', item.name || '');
                    apiItem.setAttribute('data-description', item.desc || '');

                    // Set border color based on status
                    let borderColor = 'border-green-500';
                    let statusColor = 'text-green-400';
                    let statusText = 'Ready';
                    if (item.status === 'error') {
                        borderColor = 'border-red-500';
                        statusColor = 'text-red-400';
                        statusText = 'Error';
                    } else if (item.status === 'soon') {
                        borderColor = 'border-yellow-500';
                        statusColor = 'text-yellow-400';
                        statusText = 'Soon';
                    }
                    apiItem.classList.add(borderColor);

                    // Title and Status
                    const titleDiv = document.createElement('div');
                    titleDiv.className = 'flex justify-between items-start';

                    const title = document.createElement('h3');
                    title.className = 'text-lg font-semibold text-white';
                    title.textContent = item.name;
                    titleDiv.appendChild(title);

                    const statusSpan = document.createElement('span');
                    statusSpan.className = `text-xs font-medium ${statusColor}`;
                    statusSpan.textContent = statusText;
                    titleDiv.appendChild(statusSpan);

                    apiItem.appendChild(titleDiv);

                    // Description
                    if (item.desc) {
                        const description = document.createElement('p');
                        description.className = 'text-sm text-gray-400 mt-1';
                        description.textContent = item.desc;
                        apiItem.appendChild(description);
                    }

                    // Path
                    if (item.path) {
                        const pathDiv = document.createElement('div');
                        pathDiv.className = 'mt-3';
                        const pathLabel = document.createElement('span');
                        pathLabel.className = 'text-xs font-mono bg-gray-600 text-gray-200 px-2 py-1 rounded-md';
                        pathLabel.textContent = item.path;
                        pathDiv.appendChild(pathLabel);
                        apiItem.appendChild(pathDiv);
                    }
                    
                    // Parameters
                    if (item.params) {
                        const paramsDiv = document.createElement('div');
                        paramsDiv.className = 'mt-3';
                        const paramsTitle = document.createElement('p');
                        paramsTitle.className = 'text-sm font-semibold text-primary';
                        paramsTitle.textContent = 'Parameters:';
                        paramsDiv.appendChild(paramsTitle);

                        const paramsList = document.createElement('ul');
                        paramsList.className = 'text-xs text-gray-400 list-disc list-inside ml-2';
                        
                        // Construct full path for easy copy/test
                        let fullPath = item.path ? formatPath(item.path) : '#';
                        let firstParam = true;

                        for (const key in item.params) {
                            const paramItem = document.createElement('li');
                            paramItem.innerHTML = `<span class="font-mono text-yellow-300">${key}</span>: ${item.params[key]}`;
                            paramsList.appendChild(paramItem);

                            // Build URL with example params
                            const separator = fullPath.includes('?') ? '&' : '?';
                            const exampleValue = key.toLowerCase().includes('text') ? 'Halo%20dunia' :
                                                 key.toLowerCase().includes('url') ? 'https://example.com/link' :
                                                 key.toLowerCase().includes('q') ? 'anime%20terbaru' :
                                                 'example_value';
                                                 
                            fullPath += (firstParam ? separator : '&') + `${key}=${exampleValue}`;
                            firstParam = false;
                        }
                        paramsDiv.appendChild(paramsList);
                        apiItem.appendChild(paramsDiv);

                        // Example URL (can be copied)
                        const exampleUrlDiv = document.createElement('div');
                        exampleUrlDiv.className = 'mt-3';
                        const exampleUrlText = document.createElement('p');
                        exampleUrlText.className = 'text-xs font-mono bg-gray-800 p-2 rounded-md text-blue-300 break-all cursor-pointer hover:bg-gray-700';
                        exampleUrlText.textContent = fullPath;
                        exampleUrlText.title = 'Klik untuk menyalin URL';
                        
                        exampleUrlText.onclick = function() {
                            navigator.clipboard.writeText(this.textContent).then(() => {
                                alert('URL disalin: ' + this.textContent);
                            }).catch(err => {
                                console.error('Gagal menyalin: ', err);
                            });
                        };
                        
                        exampleUrlDiv.appendChild(exampleUrlText);
                        apiItem.appendChild(exampleUrlDiv);
                    }


                    itemsContainer.appendChild(apiItem);
                });

                categoryGroup.appendChild(itemsContainer);
                apiListElement.appendChild(categoryGroup);
            });

        } catch (error) {
            console.error('Error loading APIs:', error);
            document.getElementById('apiList').innerHTML = '<div class="text-center text-red-400 py-12">Gagal memuat daftar API. Periksa console untuk detail.</div>';
        }
    }
    
    // Load Notifications
    async function loadNotifications() {
        try {
            const response = await fetch(apiBaseUrl + '/notifications.json');
            const notifications = await response.json();
            const notificationList = document.getElementById('notificationList');
            const unreadCountElement = document.getElementById('unreadCount');
            notificationList.innerHTML = '';
            let unreadCount = 0;

            notifications.sort((a, b) => new Date(b.date) - new Date(a.date));

            notifications.forEach(notif => {
                const item = document.createElement('div');
                item.className = `notification-item ${!notif.read ? 'unread' : ''}`;
                item.innerHTML = `
                    <div class="flex justify-between items-center">
                        <span class="title text-white">${notif.title}</span>
                        <span class="text-xs text-gray-500">${notif.date}</span>
                    </div>
                    <p class="text-sm mt-1">${notif.message}</p>
                `;
                notificationList.appendChild(item);

                if (!notif.read) {
                    unreadCount++;
                }
            });

            if (unreadCount > 0) {
                unreadCountElement.textContent = unreadCount;
                unreadCountElement.classList.remove('hidden');
            } else {
                unreadCountElement.classList.add('hidden');
            }
            
            if (notifications.length === 0) {
                notificationList.innerHTML = '<p class="text-center text-gray-500">Tidak ada notifikasi.</p>';
            }

        } catch (e) {
            console.error('Error loading notifications:', e);
            document.getElementById('notificationList').innerHTML = '<p class="text-center text-red-400">Gagal memuat notifikasi.</p>';
        }
    }

    // Mark all notifications as read (simulasi)
    function markAllAsRead() {
        alert('Fitur ini hanya simulasi. Untuk implementasi nyata, butuh backend.');
        document.getElementById('unreadCount').classList.add('hidden');
        document.querySelectorAll('.notification-item.unread').forEach(item => {
            item.classList.remove('unread');
        });
        closeNotificationModal();
    }


    // Search/Filter logic
    document.getElementById('searchInput').addEventListener('input', function() {
        const searchTerm = this.value.toLowerCase();
        const apiItems = document.querySelectorAll('.api-item');
        const categories = document.querySelectorAll('.category-group');
        const noResults = document.getElementById('noResults');
        let visibleCount = 0;

        apiItems.forEach(item => {
            const path = item.dataset.path.toLowerCase();
            const alias = item.dataset.alias.toLowerCase();
            const description = item.dataset.description.toLowerCase();
            
            if (path.includes(searchTerm) || alias.includes(searchTerm) || description.includes(searchTerm)) {
                item.style.display = '';
                visibleCount++;
            } else {
                item.style.display = 'none';
            }
        });

        categories.forEach(category => {
            const visibleItems = category.querySelectorAll('.api-item[style=""]');
            if (visibleItems.length > 0) {
                category.style.display = '';
            } else {
                category.style.display = 'none';
            }
        });

        if (visibleCount === 0) {
            noResults.style.display = 'block';
        } else {
            noResults.style.display = 'none';
        }
    });


    // Initial load
    document.addEventListener('DOMContentLoaded', () => {
        loadApis();
        loadNotifications();
    });
</script>

</body>
</html>
